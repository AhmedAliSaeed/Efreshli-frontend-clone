<!-- Loading State -->
<div *ngIf="isLoading()" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Loading product details...</p>
</div>

<!-- Error State -->
<div *ngIf="error()" class="error-container">
  <div class="error-message">
    <h2>Oops! Something went wrong</h2>
    <p>{{ error() }}</p>
    <button (click)="goBack()" class="btn-secondary">Go Back</button>
  </div>
</div>

<!-- Product Details -->
<div *ngIf="product() && !isLoading() && !error()" class="product-details-container">
  <!-- Breadcrumb Navigation -->
  <nav class="breadcrumb">
    <a routerLink="/" class="breadcrumb-link">Home</a>
    <span class="breadcrumb-separator">›</span>
    <a routerLink="/appliances" class="breadcrumb-link">Living Room</a>
    <span class="breadcrumb-separator">›</span>
    <a routerLink="/food-processor" class="breadcrumb-link">Accent & Arm Chairs</a>
    <span class="breadcrumb-separator">›</span>
    <span class="breadcrumb-current">{{ product()?.name }}</span>
  </nav>

  <div class="product-layout">
    <!-- Product Images Section -->
    <div class="product-images">
      <!-- Stock Badge -->
      <div class="stock-badge">1 in Stock</div>
      
      <!-- Main Image -->
      <div class="main-image-container">
        <img 
          [src]="selectedImage()" 
          [alt]="product()?.name"
          class="main-image"
          (error)="selectImage(0)"
          (keydown)="onImageKeydown($event)"
          tabindex="0"
          autofocus
        />
      </div>

      <!-- Thumbnail Images -->
      <div *ngIf="product()?.images && product()!.images.length > 1" class="thumbnail-container">
        <button
          *ngFor="let image of product()?.images; let i = index"
          (click)="selectImage(i)"
          class="thumbnail-btn"
          [class.active]="selectedImageIndex() === i"
        >
          <img [src]="image" [alt]="'Product view ' + (i + 1)" class="thumbnail-image" />
        </button>
      </div>
      
      <!-- Fast Delivery Badge -->
      <div class="fast-delivery-badge">
        <div class="delivery-arrows">
          <span class="arrow"></span>
          <span class="arrow"></span>
          <span class="arrow"></span>
        </div>
        
      </div>
    </div>

    <!-- Product Information Section -->
    <div class="product-info">
      <h1 class="product-title">{{ product()?.name }}</h1>
      
      <!-- Price Section -->
      <div class="price-section">
        <span class="price">{{ totalPrice() | currency:'EGP':'symbol':'1.0-0' }}</span>
        <span *ngIf="product()?.vatIncluded" class="vat-info">Vat Included</span>
      </div>

      <!-- Category and Brand -->
      <div class="product-meta">
        <div class="meta-item">
          <span class="meta-label">Category</span>
          <a [routerLink]="['/category', product()?.category]" class="meta-link">
            {{ product()?.category }}
          </a>
        </div>
        <div class="meta-item">
          <span class="meta-label">Brand</span>
          <a [routerLink]="['/brand', product()?.brand]" class="meta-link">
            {{ product()?.brand }}
          </a>
        </div>
      </div>

      <!-- Made to Order Info -->
      <div *ngIf="product()?.madeToOrder && deliveryDateRange()" class="delivery-info">
        <div class="delivery-badge">
          <img src="assets/CorrectDelivery.png" alt="order icon" class="badge-icon" />
          <span class="badge-text">Made to Order:</span>
        </div>
        <p class="delivery-text">
          Delivery by {{ deliveryDateRange()?.min }} - {{ deliveryDateRange()?.max }}
        </p>
      </div>

      <!-- Quantity Selection -->
      <div class="quantity-section">
        <label class="quantity-label">Quantity</label>
        <div class="quantity-controls">
          <button 
            (click)="decreaseQuantity()" 
            class="quantity-btn"
            [disabled]="quantity() <= 1"
          >
            <img src="assets/imgi_35_default.png" alt="minus" class="icon" />
          </button>

          <input 
            type="number" 
            [value]="quantity()" 
            (input)="setQuantity(+$any($event.target).value)"
            min="1"
            class="quantity-input"
          />

          <button (click)="increaseQuantity()" class="quantity-btn">
            <img src="assets/imgi_36_default.png" alt="plus" class="icon" />
          </button>

          <button (click)="addToWishlist()" class="wishlist-btn" title="Add to Wishlist">
            <img src="assets/imgi_31_default.png" alt="wishlist" class="icon heart" />
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button (click)="addToCart()" class="btn-primary btn-add-cart">
          Add to Cart
        </button>
        <button (click)="buyNow()" class="btn-secondary btn-buy-now">
          Buy now
        </button>
      </div>

      <!-- Product Options Section -->
      <div class="product-options">
        <!-- Small Product Preview -->
        <div class="small-product-preview">
          <div class="preview-container">
            <!-- علامة الصح الحمراء -->
            <div class="check-badge">
              <span class="check-icon">✓</span>
            </div>
            
            <img src="{{ selectedImage() }}" alt="{{ product()?.name }}" class="small-preview-image" />
            <div class="color-indicator-stack">
              <div class="color-dot" style="background-color: #5c4033;"></div>
              <div class="color-dot" style="background-color: #a3c9a8;"></div>
              <div class="color-dot active" style="background-color: #87ceeb;"></div>
            </div>
          </div>
        </div>


        <!-- Fabric Options -->
        <div class="option-section">
          <div class="option-header">
            <span class="option-title">Fabric</span>
            <span class="option-selected">Mint Blue Linen</span>
            <div class="selected-color-dot" style="background-color: #a3c9a8;"></div>
          </div>
          <div class="swatch-scroll-container">
            <div class="swatch-container">
              <div class="fabric-swatch" style="background-color: #d3d3d3;" title="Silver Mist" (click)="selectFabric(0)">
                <span class="swatch-label">Silver Mist</span>
              </div>
              <div class="fabric-swatch" style="background-color: #87ceeb;" title="Textured Baby Blue" (click)="selectFabric(1)">
                <span class="swatch-label">Textured Baby Blue</span>
              </div>
              <div class="fabric-swatch active" style="background-color: #a3c9a8;" title="Mint Blue Linen" (click)="selectFabric(2)">
                <span class="swatch-label">Mint Blue Linen</span>
              </div>
              <div class="fabric-swatch" style="background-color: #708090;" title="Plain Grey" (click)="selectFabric(3)">
                <span class="swatch-label">Plain Grey</span>
              </div>
              <div class="fabric-swatch" style="background-color: #d2b48c;" title="Honey Linen" (click)="selectFabric(4)">
                <span class="swatch-label">Honey Linen</span>
              </div>
              <div class="fabric-swatch" style="background-color: #5c4033;" title="Boize - Cute Fabric" (click)="selectFabric(5)">
                <span class="swatch-label">Boize - Cute Fabric</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Wood Options -->
        <div class="option-section">
          <div class="option-header">
            <span class="option-title">Ebony & Ivory Massive.</span>
            <span class="option-selected">EI-M-07/ Natural Oak</span>
            <div class="selected-color-dot" style="background-color: #cd853f;"></div>
          </div>
          <div class="swatch-scroll-container">
            <div class="swatch-container">
              <div class="wood-swatch" style="background-color: #f5f5dc;" title="EI-M-03" (click)="selectWood(0)">
                <span class="swatch-label">EI-M-03</span>
              </div>
              <div class="wood-swatch" style="background-color: #8b4513;" title="EI-M-04/ Warm Oak" (click)="selectWood(1)">
                <span class="swatch-label">EI-M-04/ Warm Oak</span>
              </div>
              <div class="wood-swatch" style="background-color: #3c2f2f;" title="EI-M-06/ Black Wash" (click)="selectWood(2)">
                <span class="swatch-label">EI-M-06/ Black Wash</span>
              </div>
              <div class="wood-swatch active" style="background-color: #cd853f;" title="EI-M-07/ Natural Oak" (click)="selectWood(3)">
                <span class="swatch-label">EI-M-07/ Natural Oak</span>
              </div>
              <div class="wood-swatch" style="background-color: #f0e68c;" title="Light Oak" (click)="selectWood(4)">
                <span class="swatch-label">Light Oak</span>
              </div>
              <div class="wood-swatch" style="background-color: #f4a460;" title="EI-M-13/ Beige" (click)="selectWood(5)">
                <span class="swatch-label">EI-M-13/ Beige</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Color Options -->
        <div class="option-section">
          <div class="option-header">
            <span class="option-title">Color</span>
            <span class="option-selected">Mint Blue</span>
            <div class="selected-color-dot" style="background-color: #a3c9a8;"></div>
          </div>
          <div class="swatch-scroll-container">
            <div class="swatch-container">
              <div class="color-swatch" style="background-color: #d3d3d3;" title="Silver Mist" (click)="selectColor(0)">
                <span class="swatch-label">Silver Mist</span>
              </div>
              <div class="color-swatch" style="background-color: #87ceeb;" title="Textured Baby Blue" (click)="selectColor(1)">
                <span class="swatch-label">Textured Baby Blue</span>
              </div>
              <div class="color-swatch active" style="background-color: #a3c9a8;" title="Mint Blue" (click)="selectColor(2)">
                <span class="swatch-label">Mint Blue</span>
              </div>
              <div class="color-swatch" style="background-color: #708090;" title="Plain Grey" (click)="selectColor(3)">
                <span class="swatch-label">Plain Grey</span>
              </div>
              <div class="color-swatch" style="background-color: #d2b48c;" title="Honey Linen" (click)="selectColor(4)">
                <span class="swatch-label">Honey Linen</span>
              </div>
              <div class="color-swatch" style="background-color: #5c4033;" title="Boize - Cute Fabric" (click)="selectColor(5)">
                <span class="swatch-label">Boize - Cute Fabric</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Professional Interior Design Section -->
      <div class="promo-section">
        <h3 class="promo-title">Transform Your Space with Professional Interior Design</h3>
        <p class="promo-description">
          Get expert help to create your dream interior. Designing with us is easier, faster, and more affordable.
        </p>
        <div class="promo-actions">
          <button class="btn-promo">Request info</button>
          <a href="#" class="promo-link">Learn more</a>
        </div>
      </div>

      <!-- Product Details Sections -->
      <div class="product-sections">
        <!-- Description -->
        <details class="product-section" open>
          <summary class="section-header">Description</summary>
          <div class="section-content">
            <p>{{ product()?.description }}</p>
          </div>
        </details>

        <!-- Product Specifications -->
        <details class="product-section">
          <summary class="section-header">Product Specifications</summary>
          <div class="section-content">
            <div class="specs-grid">
              <div *ngFor="let spec of product()?.specs | keyvalue" class="spec-item">
                <span class="spec-label">{{ spec.key }}:</span>
                <span class="spec-value">{{ spec.value }}</span>
              </div>
            </div>
          </div>
        </details>

        <!-- Additional Information -->
        <details *ngIf="product()?.additionalInfo" class="product-section">
          <summary class="section-header">Additional information</summary>
          <div class="section-content">
            <p>{{ product()?.additionalInfo }}</p>
          </div>
        </details>

        <!-- Shipping & Return Policy -->
        <details *ngIf="product()?.shippingReturn" class="product-section">
          <summary class="section-header">Shipping & Return Policy</summary>
          <div class="section-content">
            <p>{{ product()?.shippingReturn }}</p>
          </div>
        </details>
      </div>
    </div>
  </div>
</div>